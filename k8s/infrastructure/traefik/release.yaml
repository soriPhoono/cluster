apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: traefik
  namespace: traefik
spec:
  targetNamespace: traefik
  interval: 1h
  chart:
    spec:
      chart: traefik
      version: 34.4.1 # Latest as of now
      sourceRef:
        kind: HelmRepository
        name: traefik
        namespace: flux-system
  install:
    createNamespace: true
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  values:
    ingressClass:
      enabled: true
      isDefaultClass: true
    ingressRoute:
      dashboard:
        enabled: false
    service:
      type: LoadBalancer # Assuming MetalLB or similar provides IP
      additionalPorts:
        traefik:
          port: 8080
          targetPort: traefik
          expose: true
          exposedPort: 8080
          protocol: TCP
